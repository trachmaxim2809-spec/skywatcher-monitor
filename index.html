<!DOCTYPE html>
<html>

<head>
    <title>SkyWatcher Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        #map {
            height: 100vh;
            width: 100%;
            background: #0b0d0f;
        }

        body {
            margin: 0;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        // Инициализация карты
        var map = L.map('map').setView([48.3794, 31.1656], 6);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        // Настройка Firebase
        const firebaseConfig = { databaseURL: "https://skywatcher-e6b95-default-rtdb.europe-west1.firebasedatabase.app/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref('targets');

        // Слушаем новые цели
        db.on('child_added', (snapshot) => {
            const data = snapshot.val();
            let color = data.type === 'shahed' ? 'white' : (data.type === 'missile' ? 'red' : 'blue');

            L.circle([data.lat, data.lng], {
                color: color,
                fillColor: color,
                fillOpacity: 0.5,
                radius: 15000
            }).addTo(map).bindPopup(data.type.toUpperCase());
        });
    </script>
</body>

</html>